<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cronograma de Actividades | Asamblea Atacames</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #0097e6 0%, #0052d4 100%);
            --primary-color: #0097e6;
            --glass-bg: rgba(255, 255, 255, 0.98);
        }

        body {
            background: #f8f9fa;
            font-family: 'Poppins', sans-serif;
            padding-top: 160px; /* Aumentado ligeramente para acomodar el nuevo logo */
            transition: padding 0.4s ease;
        }

        /* --- NAVBAR DINÁMICA (ESTILO ASAMBLEA CANTONAL) --- */
        .navbar {
            background: var(--glass-bg) !important;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0,0,0,0.08);
            padding: 15px 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .navbar-scrolled {
            padding: 8px 0 !important;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .navbar-brand img {
            /* TAMAÑO AUMENTADO */
            max-height: 140px; /* Antes 110px */
            transition: all 0.4s ease;
            width: auto;
        }

        .navbar-scrolled .navbar-brand img {
            /* TAMAÑO AUMENTADO AL HACER SCROLL */
            max-height: 85px; /* Antes 60px */
        }

        .btn-login {
            background: var(--primary-color);
            color: white !important;
            border-radius: 50px;
            padding: 8px 25px !important;
            border: none;
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(0, 151, 230, 0.3);
            transition: 0.3s;
        }

        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 151, 230, 0.4);
        }

        /* --- CONTENIDO --- */
        .hero-activities {
            background: var(--primary-gradient);
            color: white; 
            padding: 60px 0;
            border-radius: 0 0 50px 50px; 
            margin-bottom: 40px;
        }

        .timeline-item {
            background: white; 
            border-radius: 20px;
            padding: 25px; 
            margin-bottom: 30px;
            border-left: 8px solid var(--primary-color);
            transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            cursor: pointer;
        }

        .timeline-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.12);
        }

        .date-badge {
            background: #e1f5fe; 
            color: var(--primary-color);
            padding: 8px 15px; 
            border-radius: 10px;
            font-weight: 800; 
            display: inline-block; 
            margin-bottom: 15px;
        }

        .activity-gallery {
            display: flex; 
            gap: 10px; 
            overflow-x: auto; 
            padding: 10px 0;
        }

        .activity-gallery img {
            width: 140px; 
            height: 90px; 
            object-fit: cover; 
            border-radius: 12px;
            transition: 0.3s; 
            cursor: zoom-in;
        }

        /* Modals */
        .modal-content { border-radius: 25px; border: none; overflow: hidden; }
        .modal-header-img {
            height: 250px; 
            background-size: cover; 
            background-position: center;
            position: relative; 
            display: flex; 
            align-items: flex-end; 
            padding: 30px;
        }
        .modal-header-img::after {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
        }
        .modal-title-custom { color: white; position: relative; z-index: 2; font-weight: 800; }
        
        .grid-gallery {
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px; 
            margin-top: 20px;
        }
        .grid-gallery img {
            width: 100%; height: 100px; object-fit: cover; border-radius: 10px;
            cursor: pointer; transition: 0.3s;
        }

        @media (max-width: 991px) {
            body { padding-top: 120px; }
            .navbar-brand img { max-height: 95px; }
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-light fixed-top shadow-sm" id="mainNavbar">
        <div class="container">
            <a class="navbar-brand" href="Index.html">
                <img src="https://fidelpperez2021.github.io/Almacenamiento.io/Captura%20de%20pantalla%202026-01-03%20132017.png" alt="GAD Atacames">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-lg-center">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle fw-bold" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                            Participación
                        </a>
                        <ul class="dropdown-menu animate__animated animate__fadeIn">
                            <li>
                                <a class="dropdown-item d-flex align-items-center" href="Asamblea-cantonal.html">
                                    <div class="menu-icon"><i class="fa-solid fa-people-group"></i></div>
                                    <div><span class="d-block fw-bold">Asamblea Cantonal</span><small class="text-muted">Espacio máximo de concertación.</small></div>
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item d-flex align-items-center" href="Consejos barriales.html">
                                    <div class="menu-icon"><i class="fa-solid fa-city"></i></div>
                                    <div><span class="d-block fw-bold">Consejos Barriales</span><small class="text-muted">Gestión en zonas urbanas.</small></div>
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item d-flex align-items-center" href="Silla-vacia.html">
                                    <div class="menu-icon"><i class="fa-solid fa-chair"></i></div>
                                    <div><span class="d-block fw-bold">Silla vacía</span><small class="text-muted">Derecho constitucional.</small></div>
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item d-flex align-items-center" href="Consejos rurales.html">
                                    <div class="menu-icon"><i class="fa-solid fa-people-roof"></i></div>
                                    <div><span class="d-block fw-bold">Consejos Rurales</span><small class="text-muted">Líderes de recintos.</small></div>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item"><a class="nav-link fw-bold" href="index.html#nosotros">Nosotros</a></li>
                    <li class="nav-item">
                        <button onclick="validarAcceso()" class="nav-link btn-login ms-lg-3">Admin</button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <header class="hero-activities text-center">
        <div class="container animate__animated animate__fadeIn">
            <h1 class="display-5 fw-bold">Agenda Territorial</h1>
            <p class="lead opacity-75">Actividades de la Asamblea Ciudadana de Atacames</p>
        </div>
    </header>

    <main class="container">
        <div class="row mb-5 justify-content-center">
            <div class="col-md-8 text-center">
                <div class="btn-group shadow-sm rounded-pill bg-white p-2">
                    <button type="button" class="btn btn-primary rounded-pill px-4 filter-btn" onclick="filtrar('todos')">Todas</button>
                    <button type="button" class="btn btn-light rounded-pill px-4 filter-btn" onclick="filtrar('sesion')">Sesiones</button>
                    <button type="button" class="btn btn-light rounded-pill px-4 filter-btn" onclick="filtrar('territorio')">Territorio</button>
                    <button type="button" class="btn btn-light rounded-pill px-4 filter-btn" onclick="filtrar('social')">Social</button>
                </div>
            </div>
        </div>

        <div class="row justify-content-center">
            <div class="col-lg-9" id="listaEventos">
                </div>
        </div>
    </main>

    <div class="modal fade" id="modalActividad" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content shadow-lg border-0 animate__animated animate__zoomIn">
                <div id="modalContent"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const API_URL = "https://backend-asamblea-atacames.onrender.com/api/actividades";
        let todasLasActividades = [];

        // Lógica de Scroll para el Logo
        const navbar = document.getElementById('mainNavbar');
        window.onscroll = () => {
            if (window.scrollY > 50) {
                navbar.classList.add('navbar-scrolled');
            } else {
                navbar.classList.remove('navbar-scrolled');
            }
        };

        async function obtenerActividades() {
            try {
                const response = await fetch(API_URL);
                todasLasActividades = await response.json();
                todasLasActividades.sort((a, b) => new Date(b.fecha) - new Date(a.fecha));
                renderizarActividades(todasLasActividades);
            } catch (error) {
                document.getElementById('listaEventos').innerHTML = `<p class="text-center text-danger">Error al conectar con el servidor.</p>`;
            }
        }

        function renderizarActividades(datos) {
            const contenedor = document.getElementById('listaEventos');
            contenedor.innerHTML = datos.map(act => {
                const colores = { sesion: '#0097e6', territorio: '#2ecc71', social: '#f1c40f' };
                const color = colores[act.categoria] || '#0097e6';
                
                const fechaObj = new Date(act.fecha);
                const fechaLegible = new Date(fechaObj.getTime() + fechaObj.getTimezoneOffset() * 60000)
                    .toLocaleDateString('es-ES', { day: 'numeric', month: 'long', year: 'numeric' });

                return `
                    <div class="timeline-item animate__animated animate__fadeInUp" 
                         style="border-left-color: ${color}" 
                         onclick="abrirModal('${act._id}')">
                        <div class="date-badge" style="background: ${color}22; color: ${color}">
                            <i class="fa-solid fa-calendar-day me-2"></i>${fechaLegible}
                        </div>
                        <h3 class="fw-bold">${act.titulo}</h3>
                        <p class="text-muted">${act.descripcion.substring(0, 150)}${act.descripcion.length > 150 ? '...' : ''}</p>
                        
                        ${act.imagenes && act.imagenes.length > 0 ? `
                            <div class="activity-gallery">
                                ${act.imagenes.map(img => `
                                    <img src="${img}" onclick="event.stopPropagation(); verImagen('${img}')" loading="lazy">
                                `).join('')}
                            </div>
                        ` : ''}
                        
                        <div class="mt-3 pt-3 border-top d-flex justify-content-between align-items-center">
                            <small class="text-muted"><i class="fa-solid fa-location-dot"></i> ${act.lugar}</small>
                            <span class="badge rounded-pill" style="background: ${color}">${act.categoria}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function verImagen(url) {
            Swal.fire({
                imageUrl: url,
                showConfirmButton: false,
                showCloseButton: true,
                background: 'rgba(0,0,0,0.9)',
                backdrop: 'blur(10px)',
                showClass: { popup: 'animate__animated animate__zoomIn' }
            });
        }

        function abrirModal(id) {
            const act = todasLasActividades.find(a => a._id === id);
            if (!act) return;

            const fechaObj = new Date(act.fecha);
            const fechaLegible = new Date(fechaObj.getTime() + fechaObj.getTimezoneOffset() * 60000)
                .toLocaleDateString('es-ES', { day: 'numeric', month: 'long', year: 'numeric' });

            document.getElementById('modalContent').innerHTML = `
                <div class="modal-header-img" style="background-image: url('${act.imagenes?.[0] || 'https://via.placeholder.com/800x400'}')">
                    <h2 class="modal-title-custom">${act.titulo}</h2>
                    <button type="button" class="btn-close btn-close-white position-absolute top-0 end-0 m-3" data-bs-dismiss="modal" style="z-index:10"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <i class="fa-solid fa-calendar text-primary me-2"></i><strong>${fechaLegible}</strong>
                        </div>
                        <div class="col-md-6">
                            <i class="fa-solid fa-location-dot text-danger me-2"></i><strong>${act.lugar}</strong>
                        </div>
                    </div>
                    <p style="white-space: pre-line;">${act.descripcion}</p>
                    ${act.imagenes && act.imagenes.length > 0 ? `
                        <div class="grid-gallery">
                            ${act.imagenes.map(img => `<img src="${img}" onclick="verImagen('${img}')">`).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
            new bootstrap.Modal(document.getElementById('modalActividad')).show();
        }

        function filtrar(categoria) {
            const btns = document.querySelectorAll('.filter-btn');
            btns.forEach(b => b.classList.replace('btn-primary', 'btn-light'));
            event.target.classList.replace('btn-light', 'btn-primary');
            const filtradas = categoria === 'todos' ? todasLasActividades : todasLasActividades.filter(a => a.categoria === categoria);
            renderizarActividades(filtradas);
        }

        async function validarAcceso() {
            const { value: password } = await Swal.fire({
                title: 'Acceso Administrativo',
                input: 'password',
                inputPlaceholder: 'Ingrese clave...',
                showCancelButton: true,
                confirmButtonColor: '#0097e6'
            });

            if (password === 'Admin2024') {
                window.location.href = "Actividades-admin.html";
            } else if (password) {
                Swal.fire('Error', 'Clave incorrecta', 'error');
            }
        }

        obtenerActividades();
    </script>
</body>
</html>
