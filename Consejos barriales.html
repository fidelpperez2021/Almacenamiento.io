<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Consejos Barriales - Atacames</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800&display=swap" rel="stylesheet" />
  
  <style>
    :root {
      --primary: #007bff;
      --bg: #f8f9fc;
      --dark-footer: #2d3748;
    }

    body {
      font-family: 'Plus Jakarta Sans', sans-serif;
      background: var(--bg);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    /* --- HEADER (Basado en tu imagen) --- */
    .navbar {
      background: white;
      padding: 15px 0;
      border-bottom: 1px solid #edf2f7;
    }
    .navbar-brand img {
      height: 60px;
    }
    .nav-link {
      font-weight: 700;
      color: #4a5568 !important;
      font-size: 0.9rem;
      margin-left: 20px;
    }
    .nav-link i {
      color: var(--primary);
      margin-right: 5px;
    }
    .nav-link.admin-link i {
      color: #e53e3e;
    }

    /* --- HERO SECTION --- */
    .hero-banner {
      background: linear-gradient(90deg, #0091ff 0%, #1a202c 100%);
      padding: 60px 0;
      color: white;
      text-align: center;
    }
    .hero-banner h1 {
      font-weight: 800;
      font-size: 2.5rem;
      margin-bottom: 10px;
    }

    /* --- TABLA --- */
    .main-content {
      flex: 1;
      padding: 50px 0;
    }

    /* --- ESTILOS DEL MODAL --- */
    .modal-profile-header {
      background: var(--primary);
      height: 140px;
      position: relative;
    }
    .profile-img-wrapper {
      position: absolute;
      top: 45px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
    }
    .profile-main-img, .profile-initials {
      width: 140px;
      height: 140px;
      border-radius: 50%;
      border: 6px solid white;
      object-fit: cover;
      background: #0091ff;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 3.5rem;
      font-weight: 700;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    .profile-title-section {
      margin-top: 65px;
      text-align: center;
      margin-bottom: 30px;
    }
    .profile-name { font-size: 1.6rem; font-weight: 700; color: #333; }
    .profile-label { color: var(--primary); font-weight: 800; text-transform: uppercase; font-size: 0.8rem; }

    .info-header {
      font-weight: 800; font-size: 1.1rem; color: #333;
      margin-bottom: 20px; display: flex; align-items: center; gap: 10px;
      border-bottom: 2px solid #eee; padding-bottom: 5px;
    }
    .data-label { font-size: 0.7rem; text-transform: uppercase; font-weight: 800; color: #94a3b8; margin-bottom: 2px; }
    .data-value { font-size: 0.95rem; font-weight: 600; color: #334155; margin-bottom: 15px; }

    .directory-item {
      margin-bottom: 8px; padding: 10px; border-radius: 10px; background: #fff;
      border: 1px solid #edf2f7; transition: all 0.2s ease;
    }
    .role-tag { font-size: 0.6rem; text-transform: uppercase; font-weight: 800; color: var(--primary); display: block; }
    .member-name { font-size: 0.85rem; font-weight: 700; color: #1a202c; }

    .st-ACTIVO { background: #ecfdf5; color: #10b981; padding: 4px 12px; border-radius: 50px; font-weight: 800; font-size: 0.7rem; }

    /* --- FOOTER --- */
    footer {
      background: var(--dark-footer);
      color: #cbd5e0;
      padding: 30px 0;
      font-size: 0.9rem;
      text-align: center;
    }

    .btn-close-dark { background: #1e293b; color: white; border-radius: 50px; padding: 10px 50px; font-weight: 800; border: none; }
  </style>
</head>
<body>

  <nav class="navbar navbar-expand-lg shadow-sm sticky-top">
    <div class="container">
      <a class="navbar-brand" href="#">
                <img src="https://fidelpperez2021.github.io/Almacenamiento.io/Captura%20de%20pantalla%202026-01-03%20132017.png" height="100" alt="GAD Atacames">
      <div class="ms-auto d-flex">
        <a class="nav-link" href="Index.html"><i class="fa-solid fa-house"></i> Inicio</a>
        <a class="nav-link" href="#"><i class="fa-solid fa-eye"></i> Consulta Pública</a>
        <a class="nav-link admin-link" href="https://fidelpperez2021.github.io/Almacenamiento.io/Consejos%20barriales%20Admin.html"><i class="fa-solid fa-shield-halved"></i> Modo Administrador</a>
      </div>
    </div>
  </nav>

  <header class="hero-banner">
    <div class="container">
      <h1>Consejos Barriales</h1>
      <p class="opacity-75">Consulta pública de directivas y sectores del Cantón Atacames</p>
      <div class="mt-3">
        <span class="badge rounded-pill bg-white text-primary px-3 py-2"><i class="fa-solid fa-database me-2"></i> Base de Datos Conectada</span>
      </div>
    </div>
  </header>

  <main class="main-content">
    <div class="container">
      <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
        <table class="table align-middle mb-0 table-hover">
          <thead class="bg-light">
            <tr>
              <th class="px-4 py-3">Código</th>
              <th class="py-3">Consejo Barrial</th>
              <th class="py-3">Presidente</th>
              <th class="py-3 text-center">Acción</th>
            </tr>
          </thead>
          <tbody id="listaConsejos">
            </tbody>
        </table>
      </div>
    </div>
  </main>

  <footer>
    <div class="container">
      <p class="mb-0">© 2026 Asamblea Cantonal de Participación Ciudadana de Atacames.</p>
    </div>
  </footer>

  <div class="modal fade" id="modalDetalle" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content border-0 rounded-4 overflow-hidden shadow">
        <div class="modal-body p-0">
          <div class="modal-profile-header">
            <div class="profile-img-wrapper" id="contFotoPres"></div>
          </div>
          <div class="profile-title-section">
            <h2 class="profile-name" id="detPresNombre">-</h2>
            <p class="profile-label">Presidente del Consejo</p>
          </div>
          <div class="container px-lg-5 pb-4">
            <div class="row">
              <div class="col-md-5 border-end">
                <div class="info-header"><i class="fa-solid fa-map-marked-alt text-primary"></i> Sector</div>
                <div class="data-label">Barrio / Sector</div>
                <div class="data-value" id="detBarrio">-</div>
                <div class="data-label">Parroquia</div>
                <div class="data-value" id="detParroquia">-</div>
                <div class="data-label">Estado</div>
                <div id="detEstado" class="mb-3"></div>
                <div class="data-label">Referencia</div>
                <div class="data-value small text-muted" id="detReferencia">-</div>
              </div>
              <div class="col-md-7 ps-md-4">
                <div class="info-header"><i class="fa-solid fa-users text-primary"></i> Directorio Completo</div>
                <div id="contDirectorio" style="max-height: 350px; overflow-y: auto; padding-right: 10px;"></div>
              </div>
            </div>
            <div class="text-center mt-4">
              <button class="btn btn-close-dark" data-bs-dismiss="modal">Cerrar Detalle</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const API_URL = "https://backend-asamblea-atacames.onrender.com/api/consejos-barriales";
    let cacheConsejos = [];

    async function cargarDatos() {
      try {
        const res = await fetch(API_URL);
        cacheConsejos = await res.json();
        renderizarTabla();
      } catch (e) { console.error("Error API", e); }
    }

    function renderizarTabla() {
      const tbody = document.getElementById("listaConsejos");
      tbody.innerHTML = cacheConsejos.map(c => `
        <tr>
          <td class="px-4"><code>${c.codigo}</code></td>
          <td class="fw-bold">${c.nombre}</td>
          <td>${c.directiva?.presidente?.nombres || 'No asignado'}</td>
          <td class="text-center">
            <button class="btn btn-sm btn-primary rounded-pill px-3 fw-bold" onclick="verDetalle('${c._id}')">Ver Perfil</button>
          </td>
        </tr>
      `).join('');
    }

    function verDetalle(id) {
      const c = cacheConsejos.find(x => x._id === id);
      if(!c) return;

      const dir = c.directiva || {};
      const pres = dir.presidente || {};
      
      const fotoUrl = pres.foto || pres.Perfil; 
      if(fotoUrl) {
        document.getElementById("contFotoPres").innerHTML = `<img src="${fotoUrl}" class="profile-main-img">`;
      } else {
        const iniciales = pres.nombres ? pres.nombres.split(' ').map(n => n[0]).join('').substring(0,2).toUpperCase() : "CB";
        document.getElementById("contFotoPres").innerHTML = `<div class="profile-initials">${iniciales}</div>`;
      }

      document.getElementById("detPresNombre").innerText = pres.nombres || "Sin Nombre";
      document.getElementById("detBarrio").innerText = c.barrioSector || "-";
      document.getElementById("detParroquia").innerText = c.parroquia || "-";
      document.getElementById("detReferencia").innerText = c.direccionReferencia || "-";
      document.getElementById("detEstado").innerHTML = `<span class="st-ACTIVO">${c.estado}</span>`;

      const contDir = document.getElementById("contDirectorio");
      const mbs = [];
      if(pres.nombres) mbs.push({ cargo: 'Presidente/a', nombre: pres.nombres });
      if(dir.secretario?.nombres) mbs.push({ cargo: 'Secretario/a', nombre: dir.secretario.nombres });
      if(dir.tesorero?.nombres) mbs.push({ cargo: 'Tesorero/a', nombre: dir.tesorero.nombres });
      if(dir.vocales) dir.vocales.forEach(v => { if(v.nombres) mbs.push({ cargo: v.cargo || 'Vocal', nombre: v.nombres }); });

      contDir.innerHTML = mbs.map(m => `
        <div class="directory-item shadow-sm">
          <span class="role-tag">${m.cargo}</span>
          <div class="member-name">${m.nombre}</div>
        </div>
      `).join('') || `<p class="text-muted small">Sin directiva registrada.</p>`;

      new bootstrap.Modal(document.getElementById('modalDetalle')).show();
    }

    window.onload = cargarDatos;
  </script>
</body>
</html>
